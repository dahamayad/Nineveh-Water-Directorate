@echo off
chcp 65001 >nul
echo ====================================
echo ุชุดุบูู ูุธุงู ุฅุฏุงุฑุฉ ุชูุฒูุน ุงูููุงู
echo ====================================
echo.

REM ุงูุชุญูู ูู ูุฌูุฏ Python
python --version >nul 2>&1
if errorlevel 1 (
    echo โ ุฎุทุฃ: Python ุบูุฑ ูุซุจุช ุนูู ุงููุธุงู
    echo ุงูุฑุฌุงุก ุชุซุจูุช Python ูู: https://www.python.org/downloads/
    pause
    exit /b 1
)

REM ุงูุงูุชูุงู ุฅูู ูุฌูุฏ ุงูุจุฑูุงูุฌ
cd /d "%~dp0"

REM ุงูุชุญูู ูู ูุฌูุฏ ุนูููุฉ ุชุนูู ุนูู ุงููููุฐ 9000
netstat -ano | findstr :9000 | findstr LISTENING >nul 2>&1
if not errorlevel 1 (
    echo.
    echo ====================================
    echo โ ุงูุฎุงุฏู ูุนูู ุจุงููุนู!
    echo ====================================
    echo.
    echo ๐ ุงูุฑุงุจุท:
    echo    http://127.0.0.1:9000
    echo.
    echo ๐ ุงูุณุฎ ุงูุฑุงุจุท ุฃุนูุงู ูุงูุตูู ูู ุงููุชุตูุญ
    echo.
    echo ====================================
    echo.
    echo ๐ ูุชุญ ุงููุชุตูุญ...
    ping 127.0.0.1 -n 2 >nul
    start http://127.0.0.1:9000
    echo.
    pause
    exit /b 0
)

REM ุจุฏุก ุงูุฎุงุฏู ูู ุงูุฎูููุฉ
echo ๐ ุจุฏุก ุชุดุบูู ุงูุฎุงุฏู...
start /B python server.py >server_out.log 2>server_err.log

REM ุงูุงูุชุธุงุฑ ููููุงู ููุชุฃูุฏ ูู ุจุฏุก ุงูุฎุงุฏู
ping 127.0.0.1 -n 3 >nul

REM ุงูุชุญูู ูู ูุฌุงุญ ุงูุชุดุบูู
netstat -ano | findstr :9000 | findstr LISTENING >nul 2>&1
if errorlevel 1 (
    echo โ ูุดู ุจุฏุก ุงูุฎุงุฏู
    echo ุงูุฑุฌุงุก ุงูุชุญูู ูู ููู server_err.log ูููุฒูุฏ ูู ุงูุชูุงุตูู
    pause
    exit /b 1
)

echo โ ุชู ุจุฏุก ุงูุฎุงุฏู ุจูุฌุงุญ
echo ๐ ูุชุญ ุงููุชุตูุญ...
ping 127.0.0.1 -n 2 >nul

REM ูุชุญ ุงููุชุตูุญ ุงูุงูุชุฑุงุถู
start http://127.0.0.1:9000

echo.
echo ====================================
echo โ ุงูุจุฑูุงูุฌ ูุนูู ุงูุขู!
echo ====================================
echo.
echo ๐ ุงูุฑุงุจุท:
echo    http://127.0.0.1:9000
echo.
echo ๐ ุงูุณุฎ ุงูุฑุงุจุท ุฃุนูุงู ูุงูุตูู ูู ุงููุชุตูุญ
echo.
echo ====================================
echo.
echo ๐ก ููุงุญุธุงุช:
echo    - ูุฅููุงู ุงูุฎุงุฏู: ุงุณุชุฎุฏู stop_server.bat
echo    - ุงููุงูุฐุฉ ุณุชุจูู ููุชูุญุฉ
echo.
pause
